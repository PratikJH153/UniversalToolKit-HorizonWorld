'use strict';
const path = require('path');
const fs = require('fs');
const mainPath = path.dirname(require.main.filename);

/**
 * @module Helpers
 * @description Helpers module, things that are useful but don't fit in any class
 */

/**
 * Remove non-empty directory synchronously
 * @param  {string} directory The absolute path to directory, caution, this function is dangerous
 */
function rmrfSync (directory) {

	if (fs.existsSync(directory)) {

		fs.readdirSync(directory).forEach((entry) => {

			const entryPath = path.join(directory, entry);

			if (fs.lstatSync(entryPath).isDirectory()) {
				rmrfSync(entryPath);
			} else {
				fs.unlinkSync(entryPath);
			}

		});

		fs.rmdirSync(directory);

	}

}

module.exports = {
	/**
	 * Make paths absolute (if it's not, them will be assumed as relative from main module)
	 * @param  {string} value Relative or absolute path
	 * @return {string}       Absolute path
	 */
	makePathAbsolute: (value) => {
		return path.isAbsolute(value) ? value : path.resolve(mainPath, value);
	},
	rmrfSync,
	mainPath
};